import Doc from '~/components/layout/docs'
import Now from '~/components/text/now'
import { GenericLink } from '~/components/text/link'
import { P } from '~/components/text/paragraph'
import { TerminalInput } from '~/components/text/terminal'
import Card from '~/components/card'
import Caption from '~/components/text/caption'
import { InlineCode } from '~/components/text/code'
import Note from '~/components/text/note'

export const meta = {
  title: 'Environment Variables and Secrets',
  description: 'Creating and using environment variables in Now Development',
  editUrl: 'pages/docs/v2/development/environment-variables-and-secrets.mdx',
  lastEdited: '2019-04-27T00:49:55.000Z'
}

If there's information or certain behavior of your project that needs to differ depending on if it's running locally or on Now, environment variables are the perfect solution.

Not only do they avoid having to hardcode these settings (which is very important for sensitive information, which can't just be version-controlled), but they also allow you to access information about the current environment your code is running in.

There are various ways to define environment variables in development, let's explore these options.

### Using a `.env` File

By using a `.env` file, you will define a set of key value pairs accessible from within your **Lambda** functions.

Each line in a `.env` file is written as a string and follows the format KEY=VALUE as seen in the example below:

```shell
MYSQL_PASSWORD=lambda
```

The syntax required to use an environment variable inside a Lambda function differs for each language, in Node.js this would be:

```
process.env.MYSQL_PASSWORD
```

This would return the value "lambda".

### Using a `.env.build` File

By using a `.env.build` file, you will define a set of key value pairs accessible from within the **build** object.

Each line in a `.env.build` file is written as a string and follows the format KEY=VALUE as seen in the example below:

```shell
MYSQL_DATABASE=build
```

The syntax required to use an environment variable inside a Lambda function differs for each language, in Node.js this would be:

```
process.env.DATABASE
```

This would return the value "build".

### From `now.json`

The second way of defining environment variables is made specifically for when the content of the variables you'd like to define will stay the same for every new deployment.

If that fits your project, simply add the [`env` property](/docs/v2/deployments/configuration#env) to your `now.json` file:

```json
{
  "env": {
    "DATABASE_NAME": "test"
  }
}
```

<Caption>
  An example{' '}
  <GenericLink href="/docs/v2/deployments/configuration">
    <InlineCode>now.json</InlineCode> configuration file
  </GenericLink>{' '}
  specifying an environment variable.
</Caption>

As you may have already noticed, this property holds an object which can contain as many environment variables as you need. Once again, this will assign an environment variable called "DATABASE_NAME" with a value of "test" to your deployments.

You can also pass environment variables to [Build](/docs/v2/deployments/builds/) processes on a deployment via the `build.env` configuration property:

```json
{
  "build": {
    "env": {
      "MY_KEY": "this is the value",
      "SECRET": "@my-secret-name"
    }
  }
}
```

<Caption>
  An example{' '}
  <GenericLink href="/docs/v2/deployments/configuration">
    <InlineCode>now.json</InlineCode> configuration file
  </GenericLink>{' '}
  specifying <P.B>build</P.B> environment variables.
</Caption>

The configuration above will pass the static env keys; `MY_KEY`, and `SECRET` to all [builds](/docs/v2/deployments/builds/). The `SECRET` env key is dynamically set from the `my-secret-name` [secret](#securing-environment-variables-using-secrets).

### Further Tips

We implemented some sweet functionality into the command line interface and the platform, which makes adding environment variables and secrets to your deployment even easier.

For example, you can also include `-e` multiple times:

<TerminalInput>
  now <P.B>-e</P.B> API_KEY=@my-key <P.B>-e</P.B> APP_NAME="ZEIT, Inc"
</TerminalInput>

<Caption>
  Assigning multiple environment variables in one command using the terminal.
</Caption>

Additionally, there is also the capability to inherit from your shell environment. To do so, just skip the `=value` portion of the argument:

<TerminalInput>
  now -e <P.B>MY_SHELL_VAR</P.B>
</TerminalInput>

<Caption>
  Inheriting an environment variable from the shell environment.
</Caption>

Users of the [API](/docs/api) can access the environment variables feature through the [`secrets` endpoint](/docs/api/v2#endpoints/secrets).

### Built-In Variables

By default, all deployments expose the `NOW_REGION` environment variable to [lambdas](/docs/v2/deployments/concepts/lambdas) which provides the [region](/docs/v2/platform/regions-and-providers/) that the lambda was deployed to.

### Reserved Variables

The following environment variables are [reserved](https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html#lambda-environment-variables) and therefore unavailable for use:

- **`AWS_REGION`**
- **`AWS_DEFAULT_REGION`**
- **`AWS_ACCESS_KEY_ID`**
- **`AWS_SECRET_KEY`**
- **`AWS_SECRET_ACCESS_KEY`**
- **`AWS_EXECUTION_ENV`**
- **`AWS_LAMBDA_LOG_GROUP_NAME`**
- **`AWS_LAMBDA_LOG_STREAM_NAME`**
- **`AWS_LAMBDA_FUNCTION_NAME`**
- **`AWS_LAMBDA_FUNCTION_MEMORY_SIZE`**
- **`AWS_LAMBDA_FUNCTION_VERSION`**
- **`AWS_SESSION_TOKEN`**
- **`NOW_REGION`**
- **`TZ`**
- **`_HANDLER`**
- **`LAMBDA_TASK_ROOT`**
- **`LAMBDA_RUNTIME_DIR`**

Using either, or any, of these environment variables, will result in the deployment failing.

## Read Next

Read more on how development with Now works and get answers to frequently asked questions:

<Card title="Development Basics" href="/docs/v2/development/basics">
  Learn how development works in Now and how to get started.
</Card>

<Card
  title="Frequently Asked Questions"
  href="/docs/v2/development/frequently-asked-questions"
>
  Get answers to frequently asked questions about development in Now.
</Card>

export default ({ children }) => <Doc meta={meta}>{children}</Doc>
